"use strict";angular.module("angular-cardflow",["ngTouch"]).directive("cardflow",["$swipe","$compile","$window",function(a,b,c){return{restrict:"E",template:'<div class="cardflow-container" ng-transclude ng-swipe-left="swipeLeft($event)" ng-swipe-right="swipeRight($event)"></div>',transclude:!0,scope:{model:"=?",atype:"=?",current:"=?"},link:function(b,d,e){function f(a){j.css({transform:"translate3d("+a+"px,0,0)","-webkit-transform":"translate3d("+a+"px,0,0)","-o-transform":"translate3d("+a+"px,0,0)","-moz-transform":"translate3d("+a+"px,0,0)"})}function g(a){if(k=j[1].offsetLeft,l=k+i*j.length,0===a||-1===a&&b.model.current>0||1===a&&b.model.current<j.length-1){j=d.children().children(),i=j[1].offsetLeft-j[0].offsetLeft,b.model.current+=a,b.position=-(b.model.current*i),f(b.position),j.removeClass("cardflow-active");var c=angular.element(j[b.model.current]);c.addClass("cardflow-active"),b.model.onActive&&b.model.onActive(c,b.position,b)}}function h(){if(j=d.children().children(),j&&j.length){i=j[1].offsetHeight,g(0);var c={},e=window.getComputedStyle(j[1]).transition;if(e&&(c.transition=e+""),angular.forEach(["moz","o","webkit"],function(a){e=window.getComputedStyle(j[1]).transition,e&&(c[a+"Transition"]=e)}),"swipeSnap"==b.atype||"swipeSnapKinetic"==b.atype){var c,l,o,p,q;m||(m=!0,a.bind(d,{start:function(a){angular.forEach(["moz","o","webkit"],function(a){j.css(a+"Transition","none")}),j.css({transition:"none"}),o=a.x-n[0].clientWidth/2-i,"swipeSnapKinetic"==b.atype&&(p=(new Date).getTime(),q=a.x)},end:function(a){j.css(c);var d=Math.floor(l/-i+.5);if("swipeSnapKinetic"==b.atype){var e=(new Date).getTime()-p,f=a.x-q,g=Math.abs(f/e);g>.8&&(d-=Math.floor(f/i))}d>=0?d>j.length-1&&(d=j.length-1):d=0,b.model.current=-1,b.$apply(),b.model.current=d,b.$apply()},move:function(a){l=b.position+a.x-k-o-i/2,f(l)}}))}}else setTimeout(h,100)}b.model=b.model||{},b.atype=e.atype||"swipeSnapKinetic",b.model.current=b.current||0,b.$watch("model.current",h);var i,j,k,l,m,n=d.find("div");b.$watch("type",h),angular.element(c).bind("resize",function(){g(0)}),b.swipeLeft=function(){"swipeSnapOne"==b.atype&&g(1)},b.swipeRight=function(){"swipeSnapOne"==b.atype&&g(-1)}}}}]);